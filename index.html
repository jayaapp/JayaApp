<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="content-language" content="en, pl, sa">
    <title>JayaApp - Sacred Mahabharata Reader</title>

    <!-- Social preview metadata -->
    <meta name="description" content="Learn Sanskrit by reading the Mahabharata with interactive AI help â€” JayaApp.">
    <meta property="og:title" content="JayaApp â€” Mahabharata Reader">
    <meta property="og:description" content="Learn Sanskrit by reading the Mahabharata with interactive AI help.">
    <meta property="og:image" content="https://jayaapp.github.io/assets/icon.png">
    <meta property="og:url" content="https://jayaapp.github.io/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="JayaApp">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="JayaApp â€” Mahabharata Reader">
    <meta name="twitter:description" content="Learn Sanskrit by reading the Mahabharata with interactive AI help.">
    <meta name="twitter:image" content="https://jayaapp.github.io/assets/icon.png">
    <link rel="canonical" href="https://jayaapp.github.io/">

    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/png" sizes="64x64" href="assets/icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icon.png">
    <link rel="apple-touch-icon" href="assets/icon.png">
    <link rel="shortcut icon" href="assets/icon.png">

    <!-- CSS files -->
    <!-- TrueHeart cloud sync enabled -->
    <link rel="stylesheet" href="css/trueheart-style.css">
    <link rel="stylesheet" href="css/settings.css">
    <link rel="stylesheet" href="css/booksel.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/notes.css">
    <link rel="stylesheet" href="css/user.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/init.css">
    <link rel="stylesheet" href="css/help.css">
    <link rel="stylesheet" href="css/chats.css">
    <link rel="stylesheet" href="css/helpme.css">
    <link rel="stylesheet" href="css/donate.css">
    <link rel="stylesheet" href="css/prompts.css">
    <link rel="stylesheet" href="css/pselect.css">
    <link rel="stylesheet" href="css/word-info.css">

    <!-- Init the app -->
    <script src="js/init.js"></script>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Register service worker and handle PWA install prompt -->
    <script>
      (function(){
        // Register service worker
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('/sw.js')
            .then(reg => {
              console.log('âœ… JayaApp: Service worker registered', reg.scope);
              // Listen for updates
              reg.addEventListener('updatefound', () => {
                const newWorker = reg.installing;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('ðŸ”„ JayaApp: New content available');
                  }
                });
              });
            })
            .catch(err => console.warn('JayaApp SW registration failed', err));

          navigator.serviceWorker.addEventListener('message', (event)=>{
            if (event.data && event.data.type === 'SKIP_WAITING') {
              console.log('JayaApp SW requested skip waiting');
            }
          });
        }

        // PWA Install Prompt handling
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          deferredPrompt = e;
          showInstallButton();
        });

        function showInstallButton() {
          const installBtn = document.createElement('button');
          installBtn.textContent = 'ðŸ“± Install App';
          installBtn.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2c3e50;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
          `;

          installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              console.log(`ðŸ“± JayaApp: User ${outcome} the install prompt`);
              deferredPrompt = null;
              installBtn.remove();
            }
          });

          document.body.appendChild(installBtn);
          setTimeout(() => { if (installBtn.parentNode) installBtn.remove(); }, 10000);
        }

        window.addEventListener('appinstalled', () => {
          console.log('ðŸŽ‰ JayaApp: App installed successfully!');
        });
      })();
    </script>

    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <!-- External libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <!-- App init panel -->
    <div class="init-progress">
        <img src="assets/icon.png" alt="App Logo">
        <span id="clock_loader" class="material-symbols-outlined icon-middle">progress_activity</span>
    </div>

    <!-- App panels -->
    <div id="settings-panel-container"></div>
    <div id="prompts-panel-container"></div>
    <div id="booksel-panel-container"></div>
    <div id="helpme-panel-container"></div>
    <div id="notes-panel-container"></div>
    <div id="edits-panel-container"></div>
    <div id="lists-panel-container"></div>
    <div id="chats-panel-container"></div>
    <div id="user-panel-container"></div>
    <div id="pselect-panel-container"></div>
    <div id="help-panel-container"></div>

    <!-- Main application container -->
    <div class="app-container">
        <!-- Top toolbar -->
        <header class="toolbar top-toolbar">
            <div class="toolbar-left">
                <span class="material-symbols-outlined icon-left" id="settings-icon">settings</span>
                <span class="material-symbols-outlined icon-left" id="help-toggle">help</span>
            </div>
            <div class="toolbar-right">
                <label for="book-select" locale-id="book">Book</label>
                <select id="book-select" class="icon-right-half"></select>
                <label for="chapter-select" class="icon-right" locale-id="chapter">Chapter</label>
                <select id="chapter-select" class="icon-right-half"></select>
                <span id="theme-toggle" class="material-symbols-outlined icon-right">routine</span>
            </div>
        </header>
        
        <!-- Main content area -->
        <main class="main-content">
            <div class="split-view horizontal">
                <div class="panel left-panel">
                    <div class="panel-content" id="text-panel-horizontal">
                    </div>
                </div>
                
                <div class="split-handle"></div>
                
                <div class="panel right-panel">
                    <div class="panel-content" id="chat-panel-horizontal">
                    </div>
                </div>
            </div>
            
            <div class="split-view vertical">
                <div class="panel top-panel">
                    <div class="panel-content" id="text-panel-vertical">
                    </div>
                </div>
                
                <div class="split-handle vertical-handle"></div>
                
                <div class="panel bottom-panel">
                    <div class="panel-content" id="chat-panel-vertical">
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Bottom toolbar -->
        <footer class="toolbar bottom-toolbar">
            <div class="toolbar-left">
                <i class="material-symbols-outlined icon-left" id="edit-toggle" title="Edit verse">edit</i>
                <i class="material-symbols-outlined icon-left" id="notes-toggle" title="Add note">note_add</i>
                <i class="material-symbols-outlined icon-left" id="bookmark-toggle" title="Add bookmark">bookmark</i>
                <i class="material-symbols-outlined icon-left" id="lists-toggle" title="View lists">list</i>
            </div>
            <div class="toolbar-middle">
                <i class="material-symbols-outlined icon-middle" id="prompts-toggle" title="Prompt Design">chat_paste_go</i>
                <i class="material-symbols-outlined icon-middle" id="chats-toggle" title="Chat List">list_alt</i>
            </div>
            <div class="toolbar-right">
                <i class="material-symbols-outlined icon-right" id="user-toggle" title="User profile">person</i>
                <i class="material-symbols-outlined icon-right" id="donate-toggle" title="Donate">favorite</i>
            </div>
        </footer>
    </div>
   
    <script src="js/user.js"></script>
    <script src="js/text.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/main.js"></script>
    <script src="js/help.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/alert.js"></script>
    <script src="js/notes.js"></script>
    <script src="js/edits.js"></script>
    <script src="js/lists.js"></script>
    <script src="js/chats.js"></script>
    <script src="js/clicks.js"></script>
    <script src="js/helpme.js"></script>
    <script src="js/donate.js"></script>
    <script src="js/prompts.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/word-info.js"></script>
    <script src="js/bookmarks.js"></script>
    <script src="js/highlight.js"></script>
    <script src="js/pselect.js"></script>
    <script src="js/background.js"></script>
    <script src="js/navigation.js"></script>
    <!-- TrueHeart cloud sync modules enabled -->
    
    <!-- TrueHeart Cloud Sync & User Authentication -->
    <script src="js/trueheart-integration.js"></script>
    <script src="js/trueheart-ui.js"></script>
    <script src="js/trueheart-loader.js"></script>
</body>
</html>